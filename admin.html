<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Admin - Autocore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body onload="listarTudo()">

    <div class="container my-5">
        <h1 class="text-center mb-5">Painel Administrativo (Via JS Fetch)</h1>

        <h3>Solicitações de Orçamento</h3>
        <table class="table table-striped mb-5">
            <thead><tr><th>Nome</th><th>Email</th><th>Telefone</th><th>Data Desejada</th></tr></thead>
            <tbody id="tabela-orcamentos">
                </tbody>
        </table>

        <h3>Mensagens de Contato</h3>
        <table class="table table-striped">
            <thead><tr><th>Nome</th><th>Email</th><th>Mensagem</th></tr></thead>
            <tbody id="tabela-contatos">
                </tbody>
        </table>
    </div>

    <script>
        async function listarTudo() {
            listarContatos();
            listarOrcamentos();
        }

        async function listarContatos() {
            let url = './back-php/listar_contatos.php';
            let resposta = await fetch(url);
            let dados = await resposta.json();
            
            let tabela = document.getElementById('tabela-contatos');
            let html = '';

            for (let item of dados) {
                html += `
                    <tr>
                        <td>${item.nome}</td>
                        <td>${item.email}</td>
                        <td>${item.mensagem}</td>
                    </tr>
                `;
            }
            tabela.innerHTML = html;
        }

        async function listarOrcamentos() {
            let url = './back-php/listar_orcamentos.php';
            let resposta = await fetch(url);
            let dados = await resposta.json();
            
            let tabela = document.getElementById('tabela-orcamentos');
            let html = '';

            for (let item of dados) {
                html += `
                    <tr>
                        <td>${item.nome}</td>
                        <td>${item.email}</td>
                        <td>${item.telefone}</td>
                        <td>${item.data_desejada}</td>
                    </tr>
                `;
            }
            tabela.innerHTML = html;
        }
    </script>
</body>
</html>